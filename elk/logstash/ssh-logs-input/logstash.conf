input {
  file {
    path => ["/var/log/auth.log","/var/log/secure"]
    start_position => "beginning"
    sincedb_path   => "/home/arezoo/sincedb_ssh"
    tags => ["ssh"]
    mode => "tail"
  }
}

filter {
  if "ssh" in [tags] {
    grok {
      match => {
        "message" => "^%{SYSLOGTIMESTAMP:syslog_time}\s%{HOSTNAME:host}\s%{DATA:program}(?:\[%{NUMBER:pid}\])?:\s%{GREEDYDATA:msg}$"
      }
      tag_on_failure => ["grok_ssh_failed"]
    }

    date {
      match    => [ "syslog_time", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss" ]
      timezone => "Asia/Baku"   # اگر سرورتهران است: "Asia/Tehran"
      locale   => "en"
    }

    mutate {
      convert => { "pid" => "integer" }
    }
  }
}

output {
  elasticsearch {
    hosts  => ["https://10.211.55.63:9200"]
    index  => "ssh-auth-2-%{+YYYY.MM.dd}"
    ssl_verification_mode  => none
    ssl_enabled => true
    ssl_certificate_authorities => ["/home/arezoo/cert/cacert.pem"]
    user     => "${ES_USER}"
    password => "${ES_PASSWORD}"
  }
  # stdout { codec => rubydebug }  # برای تست موقت
}
